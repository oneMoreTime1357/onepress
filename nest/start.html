<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nest &amp; Mysql 开始一个项目 | OnePress 小站</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="just playing around">
    <link rel="preload" href="/onepress/assets/css/0.styles.4a0017c5.css" as="style"><link rel="preload" href="/onepress/assets/js/app.c875f42d.js" as="script"><link rel="preload" href="/onepress/assets/js/2.48c2e0be.js" as="script"><link rel="preload" href="/onepress/assets/js/10.62473638.js" as="script"><link rel="prefetch" href="/onepress/assets/js/3.01385c65.js"><link rel="prefetch" href="/onepress/assets/js/4.5ed19beb.js"><link rel="prefetch" href="/onepress/assets/js/5.ca2e49c0.js"><link rel="prefetch" href="/onepress/assets/js/6.4dd065a5.js"><link rel="prefetch" href="/onepress/assets/js/7.a291728f.js"><link rel="prefetch" href="/onepress/assets/js/8.9e0b8726.js"><link rel="prefetch" href="/onepress/assets/js/9.2d2fe356.js">
    <link rel="stylesheet" href="/onepress/assets/css/0.styles.4a0017c5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/onepress/" class="home-link router-link-active"><!----> <span class="site-name">OnePress 小站</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/onepress/nest/" class="nav-link router-link-active">
  Nest Start
</a></div><div class="nav-item"><a href="/onepress/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/oneMoreTime1357" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/onepress/nest/" class="nav-link router-link-active">
  Nest Start
</a></div><div class="nav-item"><a href="/onepress/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><a href="https://github.com/oneMoreTime1357" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/onepress/nest/" aria-current="page" class="sidebar-link">Nest Start</a></li><li><a href="/onepress/nest/start.html" aria-current="page" class="active sidebar-link">Nest &amp; Mysql 开始一个项目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/onepress/nest/start.html#安装和创建nestjs项目" class="sidebar-link">安装和创建Nestjs项目</a></li><li class="sidebar-sub-header"><a href="/onepress/nest/start.html#module-service和controller" class="sidebar-link">Module, Service和Controller</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/onepress/nest/start.html#module" class="sidebar-link">Module</a></li><li class="sidebar-sub-header"><a href="/onepress/nest/start.html#services" class="sidebar-link">Services</a></li><li class="sidebar-sub-header"><a href="/onepress/nest/start.html#controllers" class="sidebar-link">Controllers</a></li></ul></li><li class="sidebar-sub-header"><a href="/onepress/nest/start.html#开始编码" class="sidebar-link">开始编码</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/onepress/nest/start.html#安装mysql和typeorm" class="sidebar-link">安装Mysql和typeORM</a></li></ul></li></ul></li><li><a href="/onepress/nest/log.html" class="sidebar-link">Log: 遇到的问题</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nest-mysql-开始一个项目"><a href="#nest-mysql-开始一个项目" class="header-anchor">#</a> Nest &amp; Mysql 开始一个项目</h1> <p>在这个教程里你将学到执行一个Nestjs程序有多简单，如下是使用的版本工具：</p> <ul><li>Nestjs（Modules，Controllers，Repositories，TypeORM和Entities）</li> <li><strong>Node.js &amp; NPM:</strong> (https://nodejs.org/en/download/)</li> <li><strong>Mysql2:</strong> (https://www.npmjs.com/package/mysql2)</li> <li><strong>Vscode:</strong> (https://code.visualstudio.com/download)</li></ul> <p><strong>为什么是Nest.js？</strong></p> <p>[Why Nest js？<a href="https://github.com/nestjs/nest/issues/693" target="_blank" rel="noopener noreferrer">github issue]<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>简单说Nest可以很好的支持Typescript，可扩展的Node.js服务器端应用程序框架。提供了一个开箱即用的应用程序架构，允许开发人员和团队创建高度可测试，可扩展，松散耦合且易于维护的应用程序。</p> <h2 id="安装和创建nestjs项目"><a href="#安装和创建nestjs项目" class="header-anchor">#</a> 安装和创建Nestjs项目</h2> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> -g typescript
<span class="token function">npm</span> <span class="token function">install</span> -g @nestjs/cli
</code></pre></div><p>安装好之后，接下来开始创建项目。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>nest new my-nest-project
<span class="token builtin class-name">cd</span> my-nest-project
</code></pre></div><p>在vscode中打开‘my-nest-project’，可以看到生成的项目目录</p> <ul><li>node_modules: 安装包模块</li> <li>src: 项目文件在这里</li> <li>test: 单元测试test</li> <li>nest-cli.json: 在Netsjs工作区的根目录下，为 Nestjs 提供的构建和开发工具，提供工作区范围和项目特定的配置默认值。配置中给出的路径值相对于根工作区文件夹。</li> <li>packge.json: 安装依赖在这里查看</li></ul> <h2 id="module-service和controller"><a href="#module-service和controller" class="header-anchor">#</a> Module, Service和Controller</h2> <h3 id="module"><a href="#module" class="header-anchor">#</a> Module</h3> <p>每个Nestjs应用程序都至少有一个@module()类 —— 根模块。根@Module()之所以这样命名，是因为它可以包含任何层次的子@Module()</p> <p>最重要的特性如下：</p> <ul><li>imports: 导入模块的列表,这些模块导出了此模块中所需提供者</li> <li>controllers：必须创建的一组控制器</li> <li>providers：由Nest注入器实例化的提供者,并且 可以至少在整个模块中共享</li> <li>exports：由本模块提供并应用在其他模块中可用的提供者的子集</li></ul> <h3 id="services"><a href="#services" class="header-anchor">#</a> Services</h3> <p>service服务者，负责数据存储和检索。与数据库打交道。</p> <h3 id="controllers"><a href="#controllers" class="header-anchor">#</a> Controllers</h3> <p>控制器是一个处理HTTP请求的类，负责处理传入的请求和向客户端返回响应。当Nestjs框架接收到请求时，会指向路由去进行操作。</p> <h2 id="开始编码"><a href="#开始编码" class="header-anchor">#</a> 开始编码</h2> <p>创建users模块，service和controller</p> <div class="language-shell extra-class"><pre class="language-shell"><code>nest g module <span class="token function">users</span>
nest g <span class="token function">service</span> <span class="token function">users</span>
nest g controller <span class="token function">users</span>
nest g class users/user.entity
</code></pre></div><h3 id="安装mysql和typeorm"><a href="#安装mysql和typeorm" class="header-anchor">#</a> 安装Mysql和typeORM</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> --save @nestjs/typeorm typeorm mysql2
</code></pre></div><p>接下来开始编码</p> <ul><li>打开user.entity.ts输入如下</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Entity<span class="token punctuation">,</span> Column<span class="token punctuation">,</span> PrimaryGeneratedColumn <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'typeorm'</span><span class="token punctuation">;</span>

@<span class="token function">Entity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
  @<span class="token function">PrimaryGeneratedColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  id<span class="token operator">:</span> number<span class="token punctuation">;</span>

  @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  name<span class="token operator">:</span> string<span class="token punctuation">;</span>

  @<span class="token function">Column</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'boolean'</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  isActive<span class="token operator">:</span> boolean<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>打开users.service.ts输入如下</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable<span class="token punctuation">,</span> Inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> InjectRepository <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/typeorm'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Repository <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'typeorm'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user.entity'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CreateUserDto <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./dto/create-user.dto'</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UsersService</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>
    <span class="token parameter">@<span class="token function">InjectRepository</span><span class="token punctuation">(</span>User<span class="token punctuation">)</span>
    <span class="token keyword">private</span> usersRepository<span class="token operator">:</span> Repository<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span><span class="token punctuation">,</span></span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>User<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>usersRepository<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">getUser</span><span class="token punctuation">(</span>_id<span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>User<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>usersRepository<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      select<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'isActive'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      where<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> id<span class="token operator">:</span> _id <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span>createUserDto<span class="token operator">:</span> CreateUserDto<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span>name <span class="token operator">=</span> createUserDto<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>usersRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token parameter">user<span class="token operator">:</span> User</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>usersRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token parameter">user<span class="token operator">:</span> User</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>usersRepository<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>打开users.controller.ts输入如下</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  Controller<span class="token punctuation">,</span>
  Post<span class="token punctuation">,</span>
  Body<span class="token punctuation">,</span>
  Get<span class="token punctuation">,</span>
  Put<span class="token punctuation">,</span>
  Delete<span class="token punctuation">,</span>
  Param<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UsersService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./users.service'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user.entity'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> CreateUserDto <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./dto/create-user.dto'</span><span class="token punctuation">;</span>

@<span class="token function">Controller</span><span class="token punctuation">(</span><span class="token string">'users'</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UsersController</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">private</span> service<span class="token operator">:</span> UsersService</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  @<span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>service<span class="token punctuation">.</span><span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  @<span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">':id'</span><span class="token punctuation">)</span>
  <span class="token function">get</span><span class="token punctuation">(</span>@<span class="token function">Param</span><span class="token punctuation">(</span><span class="token punctuation">)</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>service<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  @<span class="token function">Post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">create</span><span class="token punctuation">(</span>@<span class="token function">Body</span><span class="token punctuation">(</span><span class="token punctuation">)</span> createUserDto<span class="token operator">:</span> CreateUserDto<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>service<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>createUserDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  @<span class="token function">Put</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">@<span class="token function">Body</span><span class="token punctuation">(</span><span class="token punctuation">)</span> user<span class="token operator">:</span> User</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>service<span class="token punctuation">.</span><span class="token function">updateUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  @<span class="token function">Delete</span><span class="token punctuation">(</span><span class="token string">':id'</span><span class="token punctuation">)</span>
  <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token parameter">@<span class="token function">Param</span><span class="token punctuation">(</span><span class="token punctuation">)</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>service<span class="token punctuation">.</span><span class="token function">deleteUser</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>打开users.module.ts文件应该包含如下代码</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> TypeOrmModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/typeorm'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UsersService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./users.service'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UsersController <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./users.controller'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./user-entity'</span><span class="token punctuation">;</span>

@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>TypeOrmModule<span class="token punctuation">.</span><span class="token function">forFeature</span><span class="token punctuation">(</span><span class="token punctuation">[</span>User<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>UsersService<span class="token punctuation">]</span><span class="token punctuation">,</span>
  controllers<span class="token operator">:</span> <span class="token punctuation">[</span>UsersController<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UsersModule</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre></div><ul><li>现在打开app.module.ts引入database 配置文件。数据库配置可以在根目录创建ormconfig.json文件，也可以在app.module.ts设置，下面是在app.module.ts的设置。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Module <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/common'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UsersModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./users/users.module'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> TypeOrmModule <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@nestjs/typeorm'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> join <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span>

@<span class="token function">Module</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  imports<span class="token operator">:</span> <span class="token punctuation">[</span>
    TypeOrmModule<span class="token punctuation">.</span><span class="token function">forRoot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      type<span class="token operator">:</span> <span class="token string">'mysql'</span><span class="token punctuation">,</span>
      host<span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
      port<span class="token operator">:</span> <span class="token number">3306</span><span class="token punctuation">,</span>
      username<span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
      password<span class="token operator">:</span> <span class="token string">'12345678'</span><span class="token punctuation">,</span>
      database<span class="token operator">:</span> <span class="token string">'nest_project_data'</span><span class="token punctuation">,</span>
      entities<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'**'</span><span class="token punctuation">,</span> <span class="token string">'*.entity.{ts,js}'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      synchronize<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    UsersModule<span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppModule</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>在vscode中打开终端并运行</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> run start
</code></pre></div><p>执行完成之后会发现无法运行</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>TypeOrmModule<span class="token punctuation">]</span> Unable to connect to the database. Retrying <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">..</span>. +3010ms
</code></pre></div><p>原因是没有打开数据库，这个小项目使用的是mysql，运行项目前需要先启动mysql。</p> <p>项目实践github地址<a href="https://github.com/oneMoreTime1357/nest-todolist" target="_blank" rel="noopener noreferrer">nest-todolist<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://shaibenshimol.medium.com/nestjs-and-mysql-in-10-minutes-711e02ec1dab" target="_blank" rel="noopener noreferrer">Nestjs and Mysql in 5 Minutes<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/onepress/nest/" class="prev router-link-active">
        Nest Start
      </a></span> <span class="next"><a href="/onepress/nest/log.html">
        Log: 遇到的问题
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/onepress/assets/js/app.c875f42d.js" defer></script><script src="/onepress/assets/js/2.48c2e0be.js" defer></script><script src="/onepress/assets/js/10.62473638.js" defer></script>
  </body>
</html>
